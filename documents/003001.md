# Vue MVVM 部分源码解析

[源码分析的 Demo 地址](https://github.com/linmingdao/mvvm)

<p align="center"><img src="https://github.com/linmingdao/mvvm/raw/master/img/2.png"></p>

### 1. 构造器干了什么: new Vue()

- 数据代理
- 利用 Object.defineProperty 将 options.data 都代理到 vm 上, 这样可以在 methods 里面直接通过 this.xxx 来访问或者设置 Model
- 在构造器里通过 observe(data) 递归劫持 Model 的 setter 与 getter

### 2. Observer 干了什么: 监听 Model 属性的变更, 收集依赖(属性的变更需要触发哪些视图组件的更新), 实际上是收集 Watcher

- Object.defineProperty, setter 里面监测 Model 变更, 触发视图更新, Object.defineProperty getter 里面收集依赖: dep.depend()
- 确保 Model 上的每个层级都被劫持
- 在 Object.defineProperty 里面 初始化 Dep, Model 的每个属性(包括每个层级的递归属性)都会生成一个 Dep 依赖手机对象

### 3. 模板编译器 Compiler 干了什么

- 利用 Document.createDocumentFragment Api 在内存中将 Vue 的模板编译成普通的 html
- 原生不支持的标签会被保留下来, 只是不会在界面中显示而已, 所以编译器可以通过元素的子元素信息获取模板中 Vue 组件标签
- 递归编译所有节点, 把所有跟 Vue 相关的内容转换成标准 html
- 初始化 Wathcer

<p align="center"><img src="https://github.com/linmingdao/mvvm/raw/master/img/3.png"></p>

### 4. Dep(订阅发布)

- 添加 watcher 实例到订阅者列表
- notify(通知) 订阅者(watcher) update

### 5. Watcher 干了什么

- addDep, 把自己添加到订阅者中
- 获取模型的值, 更新视图
